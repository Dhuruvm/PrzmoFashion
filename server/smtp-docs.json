{
  "openapi": "3.0.0",
  "info": {
    "title": "PRZMO Secure SMTP API",
    "version": "1.0.0",
    "description": "Highly secure SMTP server API with JWT authentication, rate limiting, and comprehensive email management"
  },
  "servers": [
    {
      "url": "/api/smtp",
      "description": "SMTP API endpoints"
    }
  ],
  "components": {
    "schemas": {
      "SMTPConfig": {
        "type": "object",
        "required": ["host", "port", "secure", "auth"],
        "properties": {
          "host": {
            "type": "string",
            "description": "SMTP server hostname"
          },
          "port": {
            "type": "integer",
            "minimum": 1,
            "maximum": 65535,
            "description": "SMTP server port"
          },
          "secure": {
            "type": "boolean",
            "description": "Use SSL/TLS encryption"
          },
          "auth": {
            "type": "object",
            "required": ["user", "pass"],
            "properties": {
              "user": {
                "type": "string",
                "format": "email",
                "description": "SMTP username (email)"
              },
              "pass": {
                "type": "string",
                "minLength": 8,
                "description": "SMTP password"
              }
            }
          },
          "pool": {
            "type": "boolean",
            "default": true,
            "description": "Use connection pooling"
          },
          "maxConnections": {
            "type": "integer",
            "minimum": 1,
            "maximum": 50,
            "default": 5,
            "description": "Maximum concurrent connections"
          },
          "maxMessages": {
            "type": "integer",
            "minimum": 1,
            "maximum": 1000,
            "default": 100,
            "description": "Maximum messages per connection"
          }
        }
      },
      "Email": {
        "type": "object",
        "required": ["to", "from", "subject", "apiKey", "domain"],
        "properties": {
          "to": {
            "oneOf": [
              {
                "type": "string",
                "format": "email"
              },
              {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "email"
                }
              }
            ],
            "description": "Recipient email address(es)"
          },
          "from": {
            "type": "string",
            "format": "email",
            "description": "Sender email address"
          },
          "subject": {
            "type": "string",
            "minLength": 1,
            "maxLength": 200,
            "description": "Email subject line"
          },
          "text": {
            "type": "string",
            "description": "Plain text email content"
          },
          "html": {
            "type": "string",
            "description": "HTML email content"
          },
          "cc": {
            "oneOf": [
              {
                "type": "string",
                "format": "email"
              },
              {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "email"
                }
              }
            ],
            "description": "CC recipient email address(es)"
          },
          "bcc": {
            "oneOf": [
              {
                "type": "string",
                "format": "email"
              },
              {
                "type": "array",
                "items": {
                  "type": "string",
                  "format": "email"
                }
              }
            ],
            "description": "BCC recipient email address(es)"
          },
          "apiKey": {
            "type": "string",
            "minLength": 32,
            "description": "JWT API key for authentication"
          },
          "domain": {
            "type": "string",
            "description": "Domain associated with the API key"
          }
        }
      }
    }
  },
  "paths": {
    "/configure": {
      "post": {
        "summary": "Configure SMTP Server",
        "description": "Configure the SMTP server with connection settings",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SMTPConfig"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "SMTP server configured successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Configuration validation failed"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/send": {
      "post": {
        "summary": "Send Email",
        "description": "Send an email through the secure SMTP server",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/Email"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Email sent successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "messageId": {
                      "type": "string"
                    },
                    "message": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Email validation failed"
          },
          "401": {
            "description": "Authentication failed"
          },
          "429": {
            "description": "Rate limit exceeded"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/generate-key": {
      "post": {
        "summary": "Generate API Key",
        "description": "Generate a new JWT API key for domain access",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["domain"],
                "properties": {
                  "domain": {
                    "type": "string",
                    "description": "Domain name for the API key"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "API key generated successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "message": {
                      "type": "string"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "apiKey": {
                          "type": "string",
                          "description": "JWT API key"
                        },
                        "keyId": {
                          "type": "string",
                          "description": "Unique key identifier"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/status": {
      "get": {
        "summary": "Get Server Status",
        "description": "Retrieve SMTP server status and statistics",
        "responses": {
          "200": {
            "description": "Server status retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "object",
                      "properties": {
                        "isConnected": {
                          "type": "boolean"
                        },
                        "config": {
                          "type": "object",
                          "properties": {
                            "host": {
                              "type": "string"
                            },
                            "port": {
                              "type": "integer"
                            },
                            "secure": {
                              "type": "boolean"
                            }
                          }
                        },
                        "stats": {
                          "type": "object",
                          "properties": {
                            "totalKeys": {
                              "type": "integer"
                            },
                            "totalEmailsSent": {
                              "type": "integer"
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/keys": {
      "get": {
        "summary": "List API Keys",
        "description": "List all API keys (admin only)",
        "responses": {
          "200": {
            "description": "API keys retrieved successfully",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "success": {
                      "type": "boolean"
                    },
                    "data": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "keyId": {
                            "type": "string"
                          },
                          "domain": {
                            "type": "string"
                          },
                          "createdAt": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "lastUsed": {
                            "type": "string",
                            "format": "date-time"
                          },
                          "emailCount": {
                            "type": "integer"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/keys/{keyId}": {
      "delete": {
        "summary": "Revoke API Key",
        "description": "Revoke an existing API key",
        "parameters": [
          {
            "name": "keyId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            },
            "description": "API key identifier to revoke"
          }
        ],
        "responses": {
          "200": {
            "description": "API key revoked successfully"
          },
          "404": {
            "description": "API key not found"
          }
        }
      }
    },
    "/test": {
      "post": {
        "summary": "Send Test Email",
        "description": "Send a test email to verify SMTP configuration",
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": ["testEmail", "apiKey", "domain"],
                "properties": {
                  "testEmail": {
                    "type": "string",
                    "format": "email",
                    "description": "Email address to send test email to"
                  },
                  "apiKey": {
                    "type": "string",
                    "description": "JWT API key for authentication"
                  },
                  "domain": {
                    "type": "string",
                    "description": "Domain associated with the API key"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Test email sent successfully"
          },
          "400": {
            "description": "Test email validation failed"
          },
          "401": {
            "description": "Authentication failed"
          }
        }
      }
    }
  }
}